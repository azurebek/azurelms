{% extends "base.html" %}
{% block title %}Onboarding{% endblock %}
{% block content %}
<div class="container onboarding-wrap" x-data="onboardingWizard()" x-cloak>
  <div class="text-center mb-4">
    <div class="section-eyebrow">Onboarding</div>
    <h1 class="h3">Sizni yaxshiroq tanib olaylik</h1>
    <p class="text-muted mb-0">3 qadamli tezkor sozlash yordamida boshlaymiz.</p>
  </div>

  <form method="post" class="onboarding-form" @submit="loading = true">
    {% csrf_token %}
    <input type="hidden" name="display_name" :value="displayName">
    <input type="hidden" name="goal" :value="goal">
    <input type="hidden" name="level" :value="level">
    <input type="hidden" name="daily_commitment" :value="dailyCommitment">

    <div class="onboarding-carousel">
      <div class="onboarding-track" :style="trackStyle">
        <section class="onboarding-slide">
          <div class="onboarding-card">
            <div class="onboarding-card__title">Maqsadingiz nima?</div>
            <p class="text-muted">Sizga mos dastur va materiallar tanlaymiz.</p>

            <div class="mb-3">
              <label class="form-label">Ism (display name)</label>
              <input type="text" class="form-control form-control-lg" placeholder="Azurebek" x-model="displayName">
            </div>

            <div class="row g-3">
              <div class="col-12 col-md-4">
                <button type="button" class="onboarding-option" :class="{ 'is-active': goal === 'study' }" @click="goal = 'study'">
                  <span class="onboarding-option__icon">üéì</span>
                  Magistratura
                </button>
              </div>
              <div class="col-12 col-md-4">
                <button type="button" class="onboarding-option" :class="{ 'is-active': goal === 'work' }" @click="goal = 'work'">
                  <span class="onboarding-option__icon">üíº</span>
                  Ish
                </button>
              </div>
              <div class="col-12 col-md-4">
                <button type="button" class="onboarding-option" :class="{ 'is-active': goal === 'travel' }" @click="goal = 'travel'">
                  <span class="onboarding-option__icon">‚úàÔ∏è</span>
                  Sayohat
                </button>
              </div>
            </div>
          </div>
        </section>

        <section class="onboarding-slide">
          <div class="onboarding-card">
            <div class="onboarding-card__title">Darajangizni tanlang</div>
            <p class="text-muted">Sizga mos qiyinchilik darajasini belgilaymiz.</p>

            <div class="row g-3">
              <div class="col-12 col-md-4">
                <button type="button" class="onboarding-option" :class="{ 'is-active': level === 'zero' }" @click="level = 'zero'">
                  <span class="onboarding-option__icon">üê£</span>
                  Boshlang‚Äòich
                </button>
              </div>
              <div class="col-12 col-md-4">
                <button type="button" class="onboarding-option" :class="{ 'is-active': level === 'a1' }" @click="level = 'a1'">
                  <span class="onboarding-option__icon">üìò</span>
                  A1
                </button>
              </div>
              <div class="col-12 col-md-4">
                <button type="button" class="onboarding-option" :class="{ 'is-active': level === 'b1' }" @click="level = 'b1'">
                  <span class="onboarding-option__icon">üó£</span>
                  So‚Äòzlashuv
                </button>
              </div>
            </div>
          </div>
        </section>

        <section class="onboarding-slide">
          <div class="onboarding-card">
            <div class="onboarding-card__title">Kunlik vaqtingiz</div>
            <p class="text-muted">Qancha vaqt ajrata olasiz?</p>

            <div class="range-card">
              <div class="range-card__value">
                <span class="fw-semibold" x-text="dailyCommitment"></span> daqiqa
              </div>
              <input type="range" min="15" max="60" step="5" class="form-range" x-model="dailyCommitment">
              <div class="d-flex flex-wrap gap-2 mt-3">
                <button type="button" class="btn btn-outline-secondary" @click="dailyCommitment = 15">15</button>
                <button type="button" class="btn btn-outline-secondary" @click="dailyCommitment = 30">30</button>
                <button type="button" class="btn btn-outline-secondary" @click="dailyCommitment = 60">60</button>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>

    <div class="d-flex align-items-center justify-content-between gap-3 mt-4">
      <button type="button" class="btn btn-outline-secondary btn-lg" @click="prevStep" :disabled="step === 1">Orqaga</button>
      <div class="small text-muted">Qadam <span x-text="step"></span>/3</div>
      <button type="button" class="btn btn-primary btn-lg" @click="nextStep" :disabled="!canProceed" x-show="step < 3">Keyingi</button>
      <button type="submit" class="btn btn-success btn-lg" x-show="step === 3">Tugatish</button>
    </div>

    <div class="onboarding-loading" x-show="loading">
      <div class="spinner-border text-primary" role="status"></div>
      <div class="mt-2">Yuklanmoqda...</div>
    </div>
  </form>
</div>

<script>
  function onboardingWizard() {
    return {
      step: 1,
      displayName: "",
      goal: "",
      level: "",
      dailyCommitment: 30,
      loading: false,
      get canProceed() {
        if (this.step === 1) {
          return this.goal !== "";
        }
        if (this.step === 2) {
          return this.level !== "";
        }
        return true;
      },
      get trackStyle() {
        return `transform: translateX(-${(this.step - 1) * 100}%);`;
      },
      nextStep() {
        if (!this.canProceed) return;
        if (this.step < 3) this.step += 1;
      },
      prevStep() {
        if (this.step > 1) this.step -= 1;
      },
    };
  }
</script>
{% endblock %}
