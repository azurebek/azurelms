<!doctype html>
<html lang="en" data-bs-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}AzureLMS{% endblock %}</title>
  <script>
    const savedTheme = localStorage.getItem("theme");
    if (savedTheme) {
      document.documentElement.setAttribute("data-bs-theme", savedTheme);
    }
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  {% load static %}
  <link rel="stylesheet" href="{% static 'css/app.css' %}">
</head>

<body class="bg-light site-body">

{% if site and site.announcement %}
  <div class="announcement-bar text-center small py-2">
    <div class="container">{{ site.announcement }}</div>
  </div>
{% endif %}

<!-- ✅ NAVBAR HAR DOIM BOR -->
<nav class="navbar navbar-expand-lg bg-body border-bottom sticky-top">
  <div class="container">
    <a class="navbar-brand fw-bold d-flex align-items-center gap-2" href="/">
      {% if site and site.logo_light %}
        <img src="{{ site.logo_light.url }}" alt="{{ site.site_name }}" class="brand-logo brand-logo--light">
      {% endif %}
      {% if site and site.logo_dark %}
        <img src="{{ site.logo_dark.url }}" alt="{{ site.site_name }}" class="brand-logo brand-logo--dark">
      {% endif %}
      <span>{{ site.site_name|default:"AzureLMS" }}</span>
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="mainNavbar">
      <ul class="navbar-nav ms-lg-3 me-auto mb-2 mb-lg-0 gap-lg-2">
        {% for link in menu_links %}
          <li class="nav-item">
            <a class="nav-link" href="{{ link.url }}">{{ link.label }}</a>
          </li>
        {% endfor %}
      </ul>

      <div class="d-flex align-items-center gap-2 ms-lg-auto">
        <button class="btn btn-outline-secondary btn-sm" id="theme-toggle" type="button">
          <i class="bi bi-moon-stars"></i>
          <span class="visually-hidden">Theme toggle</span>
        </button>
        {% if request.user.is_authenticated %}
          <a class="btn btn-outline-secondary btn-sm" href="{% url 'users:dashboard' %}">Dashboard</a>
          <a class="btn btn-outline-danger btn-sm" href="{% url 'users:logout' %}">Chiqish</a>
        {% else %}
          <a class="btn btn-outline-secondary btn-sm" href="{% url 'users:login' %}">Kirish</a>
          <a class="btn btn-primary btn-sm" href="{% url 'users:signup' %}">Boshlash</a>
        {% endif %}
      </div>
    </div>
  </div>
</nav>

<main class="site-main">
  {% block content %}{% endblock %}
  {% block page %}{% endblock %}
</main>

<footer class="footer">
  <div class="container d-flex flex-column flex-md-row justify-content-between gap-2">
    <div>© {% now "Y" %} AzureLMS. Barcha huquqlar himoyalangan.</div>
    <div class="small">Yangi kurslar va yangiliklar tez orada.</div>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/htmx.org@1.9.12"></script>
<script>
  const toggle = document.getElementById("theme-toggle");
  if (toggle) {
    toggle.addEventListener("click", () => {
      const current = document.documentElement.getAttribute("data-bs-theme") || "light";
      const next = current === "light" ? "dark" : "light";
      document.documentElement.setAttribute("data-bs-theme", next);
      localStorage.setItem("theme", next);
    });
  }

  document.querySelectorAll("[data-review-video]").forEach((trigger) => {
    trigger.addEventListener("click", () => {
      const videoUrl = trigger.getAttribute("data-review-video");
      const frame = document.getElementById("reviewVideoFrame");
      if (frame) {
        frame.src = videoUrl;
      }
    });
  });

  const reviewModal = document.getElementById("reviewVideoModal");
  if (reviewModal) {
    reviewModal.addEventListener("hidden.bs.modal", () => {
      const frame = document.getElementById("reviewVideoFrame");
      if (frame) {
        frame.src = "";
      }
    });
  }

  document.querySelectorAll("[data-countdown]").forEach((node) => {
    const target = new Date(node.getAttribute("data-countdown"));
    const tick = () => {
      const now = new Date();
      const diff = target - now;
      if (diff <= 0) {
        node.textContent = "Aksiya tugadi";
        node.closest(".marketing-banner")?.classList.add("d-none");
        return;
      }
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
      const mins = Math.floor((diff / (1000 * 60)) % 60);
      node.textContent = `${days} kun ${hours} soat ${mins} daqiqa`;
    };
    tick();
    setInterval(tick, 60000);
  });
</script>
</body>
</html>
