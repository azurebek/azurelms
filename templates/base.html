<!doctype html>
<html lang="en" data-bs-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}AzureLMS{% endblock %}</title>
  <script>
    const savedTheme = localStorage.getItem("theme");
    if (savedTheme) {
      document.documentElement.setAttribute("data-bs-theme", savedTheme);
    }
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  {% load static %}
  <link rel="stylesheet" href="{% static 'css/app.css' %}">
</head>

<body class="bg-light site-body">

{% if site and site.announcement %}
  <div class="announcement-bar text-center small py-2">
    <div class="container">{{ site.announcement }}</div>
  </div>
{% endif %}

{% include "core/navbar.html" %}
{% include "core/messages.html" %}

<main class="site-main">
  {% block content %}{% endblock %}
  {% block page %}{% endblock %}
</main>

{% include "communication/components/chat_bubble.html" %}
{% include "core/bottom_nav.html" %}
{% include "core/footer.html" %}

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script>
  const toggle = document.getElementById("theme-toggle");
  if (toggle) {
    toggle.addEventListener("click", () => {
      const current = document.documentElement.getAttribute("data-bs-theme") || "light";
      const next = current === "light" ? "dark" : "light";
      document.documentElement.setAttribute("data-bs-theme", next);
      localStorage.setItem("theme", next);
    });
  }

  document.querySelectorAll("[data-review-video]").forEach((trigger) => {
    trigger.addEventListener("click", () => {
      const videoUrl = trigger.getAttribute("data-review-video");
      const frame = document.getElementById("reviewVideoFrame");
      if (frame) {
        frame.src = videoUrl;
      }
    });
  });

  const reviewModal = document.getElementById("reviewVideoModal");
  if (reviewModal) {
    reviewModal.addEventListener("hidden.bs.modal", () => {
      const frame = document.getElementById("reviewVideoFrame");
      if (frame) {
        frame.src = "";
      }
    });
  }

  document.querySelectorAll("[data-countdown]").forEach((node) => {
    const target = new Date(node.getAttribute("data-countdown"));
    const tick = () => {
      const now = new Date();
      const diff = target - now;
      if (diff <= 0) {
        node.textContent = "Aksiya tugadi";
        node.closest(".marketing-banner")?.classList.add("d-none");
        return;
      }
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
      const mins = Math.floor((diff / (1000 * 60)) % 60);
      node.textContent = `${days} kun ${hours} soat ${mins} daqiqa`;
    };
    tick();
    setInterval(tick, 60000);
  });
</script>
</body>
</html>
